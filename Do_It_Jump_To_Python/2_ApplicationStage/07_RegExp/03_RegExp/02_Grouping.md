# Grouping
ABC 문자열이 계속해서 반복되는지 조사하는 정구식을 작성하고 싶다고 하면 어떻게 해야 할까?  
이럴 때 다음과 같이 그루핑을 사용하여 작성할 수 있다.  
```
(ABC+)
```
그룹을 만들어 주는 메타 문자가 `()`이다.  
  
```
>>> p = re.compile( '(ABC)+' )
>>> m = p.search( 'ABCABCABC OK?' )
>>> print( m )
<_sre.SRE_Match object at 0x1072ec030>
>>> print( m.group() )
ABCABCABC
```
`r'\w+\s+\d+[-]\d+[-]\d+'`은 `이름 + " " + 전화번호` 형태의 문자열을 찾는 정규식이다.  
이렇게 매치된 문자열 중에서 이름만 뽑아내고 싶다면 어떻게 해야 할까?  
  
```
>>> p = re.compile( r'(\w+)\s+\d+[-]\d+[-]\d+' )
>>> m = p.search( 'ASDF 010-1234-1234' )
>>> print( m.group(1) )
ASDF
```
이름에 해당하는 `\w+` 부분을 그룹 `(\w+)`으로 만들면 match 객체의 group(인덱스) 메소드를 사용하여 그루핑 된 부분의 문자열만 뽑아낼 수 있다.  
group 메소드의 인덱스는 다음과 같은 의미를 갖는다.
- group( 0 ) : 매치된 전체 문자열
- group( 1 ) : 첫 번째 그룹에 해당하는 문자열
- group( 2 ) : 두 번째 그룹에 해당하는 문자열
- group( n ) : n 번째 그룹에 해당하는 문자열
  
```
>>> p = re.compile( r'(\w+)\s+(\d+[-]\d+[-]\d+)' )
>>> m = p.search( 'ASDF 010-1234-1234' )
>>> print( m.group(2) )
010-1234-1234
```
이번에는 전화번호 부분을 추가로 그룹 `(\d+[-]\d+[-]\d+)`으로 만들었다.  
이렇게 하면 전화번호만 뽑아낼 수 있다.  
  
```
>>> p = re.compile( r'(\w+)\s+((\d+)[-]\d+[-]\d+)' )
>>> m = p.search( 'ASDF 010-1234-1234' )
>>> print( m.group(3) )
010
```
`(\w+)\s+((\d+)[-]\d+[-]\d+)` 이렇게 중첩되게 사용하는 것도 가능하다.  
그룹이 중첩되어 있는 경우는 바깥쪽부터 시작하여 안쪽으로 들어갈수록 인덱스가 증가한다.  
  
  
# 그루핑된 문자열 재참조 하기
그룹의 또 하나의 좋은 점은 한 번 그루핑한 문자열을 재참조(Backreferences)할 수 있다는 점이다.  
```
>>> p = re.compile( r'(\b\w+)\s+\1' )
>>> p.search( 'Paris in the the spring' ).group()
'the the'
```
정규식 `(\b\w+)\s+\1`는 `(그룹) + " " + 그룹과 동일한 단어`와 매치됨을 의미한다.  
이렇게 정규식을 만들게 되면 2개의 동일한 단어를 여속적으로 사용해야만 매치된다.  
이것을 가능하게 해주는 것이 바로 재 참조 메타문자인 `\1`이다.  
정규식의 그룹 중 첫 번째 그룹을 가리킨다.  
  
# 그루핑된 문자열에 이름 붙이기
정규식 안에 그룹이 많아진다고 가정하면, 혼란스러울 테고,  
거기에 정규식이 수정되면서 그룹이 추가, 삭제되면 그 그룹을 인덱스로 참조한 프로그램도 모두 변경해 주어야 하는 위험도 갖게 된다.  
  
만약 그룹을 인덱스가 아닌 이름(Name Groups)으로 참조할 수 있다면?  
```
(?P<name>\w+)\s+((\d+)[-]\d+[-]\d+)
```
`(\w+)`가 `(?P<name>\w+)`로 바뀌었다.  
`(\w+)`라는 그룹에 name이라는 이름을 붙였다.  
여기서 사용한 `(?...)` 표현식은 정규 표현식의 확장 구문이다.  
이 확장 구문을 사용하기 시작하면 가독성이 떨어지지만 강력함을 갖게 된다.  
```
>>> p = re.compile( r'(?P<name>\w+)\s+((\d+)[-]\d+[-]\d+)' )
>>> m = p.search( 'ASDF 010-1234-1234' )
>>> print( m.group('name') )
ASDF
```
name이라는 그룹 이름으로 참조할 수 있다.  
그룹 이름을 사용하면 정규식 안에서 재참조하는 것도 가능하다.
```
>>> p = re.compile( r'(?P<word>\b\w+)\s+(?P=word)' )
>>> p.search( 'Paris in the the spring' ).group()
'the the'
```
재 참조할 때는 `(?P=그룹이름)`이라는 확장 구문을 사용해야 한다.

